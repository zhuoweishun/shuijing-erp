# å­—æ®µå¼•ç”¨æ··æ·†æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ¦‚è¿°

åŸºäºæ–°çš„ä¸šåŠ¡é€»è¾‘ï¼ˆpurchaseâ†’materialâ†’SKUï¼‰ï¼Œå¯¹ä»£ç ä¸­å¯èƒ½å­˜åœ¨çš„å­—æ®µå’Œå¼•ç”¨æ··æ·†é—®é¢˜è¿›è¡Œå…¨é¢æ£€æŸ¥ã€‚

**æ£€æŸ¥æ—¶é—´**: 2025å¹´1æœˆ17æ—¥  
**æ£€æŸ¥èŒƒå›´**: SKUç›¸å…³çš„æ‰€æœ‰åŠŸèƒ½æ¨¡å—  
**ä¸šåŠ¡é€»è¾‘**: é‡‡è´­å½•å…¥(purchase) â†’ è½¬åŒ–ä¸ºåŸææ–™(material) â†’ åˆ¶ä½œSKU  

## ğŸš¨ å‘ç°çš„ä¸»è¦æ··æ·†é—®é¢˜

### 1. SKUåˆ¶ä½œæµç¨‹ä¸­çš„æ¦‚å¿µæ··æ·†

**é—®é¢˜ä½ç½®**: `backend/src/routes/products.ts`

**å…·ä½“é—®é¢˜**:
- **ç›´æ¥è½¬åŒ–æ¨¡å¼**ï¼ˆç¬¬800-1000è¡Œï¼‰ï¼šä»purchaseè®°å½•ç›´æ¥åˆ›å»ºSKUï¼Œè·³è¿‡äº†materialæ¦‚å¿µ
- **ç»„åˆåˆ¶ä½œæ¨¡å¼**ï¼ˆç¬¬400-800è¡Œï¼‰ï¼šåŒæ ·ç›´æ¥ä½¿ç”¨purchaseè®°å½•åˆ¶ä½œSKU

**é”™è¯¯é€»è¾‘**:
```typescript
// é”™è¯¯ï¼šç›´æ¥ä»purchaseåˆ›å»ºSKU
const purchase = await tx.purchase.findUnique({
  where: { id: productData.materialId }
})

// åº”è¯¥æ˜¯ï¼šä»materialåº“å­˜åˆ›å»ºSKU
// ä½†å½“å‰ä»£ç ä¸­æ²¡æœ‰ç‹¬ç«‹çš„materialè¡¨
```

**å½±å“**: è¿åäº†purchaseâ†’materialâ†’SKUçš„ä¸šåŠ¡æµç¨‹

### 2. åº“å­˜æŸ¥è¯¢çš„æ¦‚å¿µæ··æ·†

**é—®é¢˜ä½ç½®**: `backend/src/routes/inventory.ts`

**å…·ä½“é—®é¢˜**:
- åº“å­˜æŸ¥è¯¢ç›´æ¥æŸ¥è¯¢purchaseè¡¨ï¼Œè€Œä¸æ˜¯materialåº“å­˜
- ç¼ºå°‘ç‹¬ç«‹çš„materialåº“å­˜ç®¡ç†

**é”™è¯¯é€»è¾‘**:
```sql
-- å½“å‰æŸ¥è¯¢purchaseè¡¨ä½œä¸ºåº“å­˜
SELECT p.id as purchase_id, p.productName as product_name
FROM purchases p

-- åº”è¯¥æŸ¥è¯¢materialè¡¨
-- ä½†å½“å‰ç³»ç»Ÿä¸­materialå’Œpurchaseæ˜¯åŒä¸€æ¦‚å¿µ
```

**å½±å“**: åº“å­˜æ¦‚å¿µä¸æ¸…æ™°ï¼Œpurchaseå’Œmaterialæ··ç”¨

### 3. æ•°æ®æ¨¡å‹è®¾è®¡é—®é¢˜

**é—®é¢˜ä½ç½®**: `backend/prisma/schema.prisma`

**å…·ä½“é—®é¢˜**:
- ç¼ºå°‘ç‹¬ç«‹çš„Materialæ¨¡å‹
- Purchaseç›´æ¥ä½œä¸ºåŸææ–™ä½¿ç”¨
- SKUåˆ¶ä½œæ—¶ç›´æ¥å…³è”Purchaseè€Œä¸æ˜¯Material

**å½“å‰æ¨¡å‹å…³ç³»**:
```
Purchase â†’ MaterialUsage â†’ Product â†’ SKU
```

**æœŸæœ›æ¨¡å‹å…³ç³»**:
```
Purchase â†’ Material â†’ MaterialUsage â†’ Product â†’ SKU
```

### 4. APIæ¥å£å‘½åæ··æ·†

**é—®é¢˜ä½ç½®**: å¤šä¸ªAPIæ¥å£

**å…·ä½“é—®é¢˜**:
- `/finished-products` æ¥å£å®é™…åˆ›å»ºçš„æ˜¯SKUï¼Œä¸æ˜¯æˆå“
- æ¥å£åç§°ä¸å®é™…åŠŸèƒ½ä¸ç¬¦

**æ··æ·†ç¤ºä¾‹**:
```typescript
// æ¥å£åç§°: finished-products
// å®é™…åŠŸèƒ½: åˆ›å»ºSKU
router.post('/', authenticateToken, asyncHandler(async (req, res) => {
  // åˆ›å»ºSKUçš„é€»è¾‘
}))
```

### 5. å‰ç«¯ç»„ä»¶æ¦‚å¿µæ··æ·†

**é—®é¢˜ä½ç½®**: `src/components/FinishedProductGrid.tsx`

**å…·ä½“é—®é¢˜**:
- ç»„ä»¶åç§°ä¸ºFinishedProductGridï¼Œä½†å®é™…æ˜¾ç¤ºçš„æ˜¯purchaseæ•°æ®
- æ•°æ®ç±»å‹å®šä¹‰ä¸­åŒ…å«purchase_idå­—æ®µï¼Œæ··æ·†äº†æˆå“å’Œé‡‡è´­æ¦‚å¿µ
- è°ƒç”¨getFinishedProducts APIï¼Œä½†è¿”å›çš„æ˜¯purchaseè¡¨æ•°æ®

**é”™è¯¯é€»è¾‘**:
```typescript
// é”™è¯¯ï¼šå°†purchaseæ•°æ®å½“ä½œæˆå“æ˜¾ç¤º
interface FinishedProduct {
  purchase_id: string  // é‡‡è´­IDï¼Œä¸åº”è¯¥åœ¨æˆå“æ¥å£ä¸­
  purchase_code?: string
  product_name: string
  // ...
}

// é”™è¯¯ï¼šè°ƒç”¨æˆå“APIä½†æŸ¥è¯¢é‡‡è´­è¡¨
const response = await inventoryApi.getFinishedProducts(params)
```

**å½±å“**: ç”¨æˆ·ç•Œé¢æ¦‚å¿µæ··æ·†ï¼Œpurchaseå’Œæˆå“æ¦‚å¿µä¸æ¸…

## ğŸ“‹ è¯¦ç»†æ£€æŸ¥ç»“æœ

### SKUåˆ¶ä½œç›¸å…³æ£€æŸ¥

| æ£€æŸ¥é¡¹ç›® | çŠ¶æ€ | é—®é¢˜æè¿° | å½±å“ç¨‹åº¦ |
|---------|------|----------|----------|
| SKUåˆ¶ä½œAPI | âŒ æœ‰é—®é¢˜ | ç›´æ¥ä»purchaseåˆ¶ä½œï¼Œè·³è¿‡materialæ¦‚å¿µ | é«˜ |
| åŸææ–™æ‰£å‡é€»è¾‘ | âŒ æœ‰é—®é¢˜ | ç›´æ¥æ“ä½œpurchaseçŠ¶æ€ï¼Œç¼ºå°‘materialåº“å­˜ç®¡ç† | é«˜ |
| ä¸šåŠ¡æµç¨‹ä¸€è‡´æ€§ | âŒ æœ‰é—®é¢˜ | è¿åpurchaseâ†’materialâ†’SKUæµç¨‹ | é«˜ |
| å­—æ®µå‘½åè§„èŒƒ | âœ… æ­£å¸¸ | å‰ç«¯snake_caseï¼Œåç«¯camelCaseä¸€è‡´ | æ—  |

### å‰ç«¯ç»„ä»¶ç›¸å…³æ£€æŸ¥

| æ£€æŸ¥é¡¹ç›® | çŠ¶æ€ | é—®é¢˜æè¿° | å½±å“ç¨‹åº¦ |
|---------|------|----------|----------|
| FinishedProductGridç»„ä»¶ | âŒ æœ‰é—®é¢˜ | æ˜¾ç¤ºpurchaseæ•°æ®ä½œä¸ºæˆå“ï¼Œæ¦‚å¿µæ··æ·† | ä¸­ |
| åº“å­˜æŸ¥è¯¢æ¥å£è°ƒç”¨ | âŒ æœ‰é—®é¢˜ | è°ƒç”¨getFinishedProductsæŸ¥è¯¢purchaseè¡¨ | ä¸­ |
| æ•°æ®ç±»å‹å®šä¹‰ | âŒ æœ‰é—®é¢˜ | FinishedProductæ¥å£åŒ…å«purchase_idå­—æ®µ | ä¸­ |
| ä¸šåŠ¡é€»è¾‘ç†è§£ | âŒ æœ‰é—®é¢˜ | å‰ç«¯å°†purchaseå½“ä½œæˆå“å¤„ç† | ä¸­ |

### åº“å­˜æŸ¥è¯¢ç›¸å…³æ£€æŸ¥

| æ£€æŸ¥é¡¹ç›® | çŠ¶æ€ | é—®é¢˜æè¿° | å½±å“ç¨‹åº¦ |
|---------|------|----------|----------|
| åº“å­˜æ•°æ®æº | âŒ æœ‰é—®é¢˜ | æŸ¥è¯¢purchaseè¡¨è€Œä¸æ˜¯materialåº“å­˜ | ä¸­ |
| åº“å­˜è®¡ç®—é€»è¾‘ | âš ï¸ éƒ¨åˆ†é—®é¢˜ | é€šè¿‡MaterialUsageè®¡ç®—å‰©ä½™é‡ï¼Œé€»è¾‘æ­£ç¡®ä½†æ¦‚å¿µæ··æ·† | ä¸­ |
| åº“å­˜åˆ†ç±» | âŒ æœ‰é—®é¢˜ | æŒ‰purchaseåˆ†ç±»è€Œä¸æ˜¯materialåˆ†ç±» | ä¸­ |

### æ•°æ®å…³è”æ£€æŸ¥

| æ£€æŸ¥é¡¹ç›® | çŠ¶æ€ | é—®é¢˜æè¿° | å½±å“ç¨‹åº¦ |
|---------|------|----------|----------|
| Purchase-Materialå…³è” | âŒ ç¼ºå¤± | æ²¡æœ‰ç‹¬ç«‹çš„Materialæ¨¡å‹ | é«˜ |
| Material-SKUå…³è” | âŒ ç¼ºå¤± | SKUç›´æ¥å…³è”Purchase | é«˜ |
| æ•°æ®æµå‘ä¸€è‡´æ€§ | âŒ æœ‰é—®é¢˜ | è·³è¿‡materialç¯èŠ‚ | é«˜ |

## ğŸ”§ ä¿®å¤å»ºè®®

### 1. æ•°æ®æ¨¡å‹é‡æ„

**å»ºè®®**: åˆ›å»ºç‹¬ç«‹çš„Materialæ¨¡å‹

```prisma
model Material {
  id          String   @id @default(uuid())
  materialCode String  @unique // åŸææ–™ç¼–ç 
  name        String   // åŸææ–™åç§°
  type        String   // åŸææ–™ç±»å‹
  specification String? // è§„æ ¼
  quality     String?  // å“è´¨
  
  // åº“å­˜ä¿¡æ¯
  totalQuantity     Int     // æ€»æ•°é‡
  availableQuantity Int     // å¯ç”¨æ•°é‡
  unit             String  // å•ä½
  
  // æˆæœ¬ä¿¡æ¯
  unitCost    Decimal // å•ä½æˆæœ¬
  totalValue  Decimal // æ€»ä»·å€¼
  
  // å…³è”å…³ç³»
  purchaseId  String  // æ¥æºé‡‡è´­è®°å½•
  purchase    Purchase @relation(fields: [purchaseId], references: [id])
  
  // SKUåˆ¶ä½œä½¿ç”¨è®°å½•
  materialUsages MaterialUsage[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("materials")
}
```

### 2. ä¸šåŠ¡æµç¨‹é‡æ„

**æ­¥éª¤1**: é‡‡è´­å½•å…¥æ—¶è‡ªåŠ¨åˆ›å»ºMaterialè®°å½•
```typescript
// é‡‡è´­å®Œæˆåï¼Œè‡ªåŠ¨è½¬åŒ–ä¸ºMaterial
const material = await tx.material.create({
  data: {
    materialCode: generateMaterialCode(),
    name: purchase.productName,
    type: purchase.productType,
    totalQuantity: purchase.quantity,
    availableQuantity: purchase.quantity,
    unitCost: purchase.unitPrice,
    purchaseId: purchase.id
  }
})
```

**æ­¥éª¤2**: SKUåˆ¶ä½œæ—¶ä½¿ç”¨Materialè€Œä¸æ˜¯Purchase
```typescript
// æ­£ç¡®ï¼šä»Materialåˆ¶ä½œSKU
const material = await tx.material.findUnique({
  where: { id: materialId }
})

if (material.availableQuantity < requiredQuantity) {
  throw new Error('åŸææ–™åº“å­˜ä¸è¶³')
}
```

### 3. APIæ¥å£é‡æ„

**å»ºè®®**: é‡å‘½åå’Œé‡æ„ç›¸å…³æ¥å£

```typescript
// åŸææ–™åº“å­˜æŸ¥è¯¢
router.get('/materials', async (req, res) => {
  // æŸ¥è¯¢Materialè¡¨è€Œä¸æ˜¯Purchaseè¡¨
})

// SKUåˆ¶ä½œæ¥å£
router.post('/skus/create', async (req, res) => {
  // æ˜ç¡®è¡¨ç¤ºè¿™æ˜¯SKUåˆ¶ä½œæ¥å£
})
```

### 4. åº“å­˜æŸ¥è¯¢é‡æ„

**å»ºè®®**: ä¿®æ”¹åº“å­˜æŸ¥è¯¢é€»è¾‘

```typescript
// æŸ¥è¯¢åŸææ–™åº“å­˜
const materials = await prisma.material.findMany({
  where: {
    availableQuantity: { gt: 0 }
  },
  include: {
    purchase: true // åŒ…å«æ¥æºé‡‡è´­ä¿¡æ¯
  }
})
```

## ğŸ¯ ä¼˜å…ˆä¿®å¤é¡¹ç›®

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³ä¿®å¤ï¼‰
1. **åˆ›å»ºMaterialæ¨¡å‹** - å»ºç«‹ç‹¬ç«‹çš„åŸææ–™åº“å­˜ç®¡ç†
2. **é‡æ„SKUåˆ¶ä½œæµç¨‹** - ç¡®ä¿ä»Materialåˆ¶ä½œè€Œä¸æ˜¯Purchase
3. **ä¿®å¤ä¸šåŠ¡æµç¨‹** - å®ç°purchaseâ†’materialâ†’SKUçš„å®Œæ•´æµç¨‹

### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸä¿®å¤ï¼‰
1. **é‡æ„åº“å­˜æŸ¥è¯¢** - æŸ¥è¯¢Materialè¡¨è€Œä¸æ˜¯Purchaseè¡¨
2. **APIæ¥å£é‡å‘½å** - æ˜ç¡®æ¥å£åŠŸèƒ½å’Œå‘½å
3. **æ•°æ®è¿ç§»è„šæœ¬** - å°†ç°æœ‰Purchaseæ•°æ®è½¬æ¢ä¸ºMaterial

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰
1. **å‰ç«¯ç•Œé¢è°ƒæ•´** - é€‚é…æ–°çš„æ•°æ®æ¨¡å‹
2. **æ–‡æ¡£æ›´æ–°** - æ›´æ–°ä¸šåŠ¡æµç¨‹æ–‡æ¡£
3. **æµ‹è¯•ç”¨ä¾‹è¡¥å……** - ç¡®ä¿æ–°æµç¨‹çš„æ­£ç¡®æ€§

## ğŸ“Š å½±å“è¯„ä¼°

### ä¸šåŠ¡å½±å“
- **æ•°æ®ä¸€è‡´æ€§**: å½“å‰æ··æ·†å¯èƒ½å¯¼è‡´æ•°æ®ç†è§£å›°éš¾
- **ä¸šåŠ¡æµç¨‹**: è·³è¿‡materialç¯èŠ‚å½±å“åº“å­˜ç®¡ç†ç²¾ç¡®æ€§
- **ç”¨æˆ·ä½“éªŒ**: æ¦‚å¿µæ··æ·†å¯èƒ½å¯¼è‡´æ“ä½œå›°æƒ‘

### æŠ€æœ¯å½±å“
- **ä»£ç ç»´æŠ¤**: æ¦‚å¿µä¸æ¸…æ™°å¢åŠ ç»´æŠ¤éš¾åº¦
- **åŠŸèƒ½æ‰©å±•**: ç¼ºå°‘materialå±‚çº§é™åˆ¶åŠŸèƒ½æ‰©å±•
- **æ•°æ®æŸ¥è¯¢**: ç›´æ¥æŸ¥è¯¢purchaseå½±å“æŸ¥è¯¢æ•ˆç‡

## ğŸ“ æ€»ç»“

å½“å‰ç³»ç»Ÿå­˜åœ¨æ˜æ˜¾çš„æ¦‚å¿µæ··æ·†é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š

1. **ç¼ºå°‘Materialæ¦‚å¿µ**: Purchaseç›´æ¥ä½œä¸ºåŸææ–™ä½¿ç”¨
2. **ä¸šåŠ¡æµç¨‹ä¸å®Œæ•´**: è·³è¿‡materialç¯èŠ‚ç›´æ¥åˆ¶ä½œSKU
3. **æ•°æ®æ¨¡å‹ä¸æ¸…æ™°**: ç¼ºå°‘ç‹¬ç«‹çš„åŸææ–™åº“å­˜ç®¡ç†

å»ºè®®ä¼˜å…ˆè¿›è¡Œæ•°æ®æ¨¡å‹é‡æ„ï¼Œå»ºç«‹å®Œæ•´çš„purchaseâ†’materialâ†’SKUä¸šåŠ¡æµç¨‹ï¼Œç¡®ä¿ç³»ç»Ÿæ¦‚å¿µæ¸…æ™°ã€æ•°æ®ä¸€è‡´ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025å¹´1æœˆ17æ—¥  
**æ£€æŸ¥äººå‘˜**: SOLO Coding  
**ä¸‹æ¬¡æ£€æŸ¥**: ä¿®å¤å®Œæˆåè¿›è¡ŒéªŒè¯æ£€æŸ¥