## æ–‡æ¡£ 8ï¼šéƒ¨ç½²è¿ç»´è§„èŒƒæ–‡æ¡£ï¼ˆæå–ç°æœ‰é…ç½®ï¼‰

### ä¸€ã€ç¯å¢ƒé…ç½®ï¼ˆæå–è‡ªã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹8 ç« ï¼‰

#### 1.1 ç¯å¢ƒå˜é‡è§„èŒƒï¼ˆç»Ÿä¸€ç°æœ‰å‘½åï¼‰

| ç¯å¢ƒå˜é‡å                    | ç”¨é€”                | ç¤ºä¾‹å€¼                    | æ¥æºæ–‡æ¡£          |
| ------------------------ | ----------------- | ---------------------- | ------------- |
| NODE\_ENV                | ç¯å¢ƒæ ‡è¯†              | production/development | ã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹8.2.2 |
| PORT                     | åç«¯ç«¯å£              | 3001                   | ã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹8.2.2 |
| DOUBAO\_API\_KEY         | è±†åŒ… AI å¯†é’¥          | 0a7c42e7-d1d3-4d53-9b83-dca43b9b2c81 | ã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹2.3.1 |
| OSS\_ACCESS\_KEY\_ID     | é˜¿é‡Œäº‘ OSS å¯†é’¥ ID     | LTAIxxx                | ã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹2.3.2 |
| OSS\_ACCESS\_KEY\_SECRET | é˜¿é‡Œäº‘ OSS å¯†é’¥ Secret | xxx                    | ã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹2.3.2 |
| MYSQL\_HOST              | MySQLæ•°æ®åº“åœ°å€        | localhost/RDSåœ°å€       | ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹1.1 |
| MYSQL\_PORT              | MySQLç«¯å£           | 3306                   | ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹1.1 |
| MYSQL\_USER              | MySQLç”¨æˆ·å          | root                   | ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹1.1 |
| MYSQL\_PASSWORD          | MySQLå¯†ç            | xxx                    | ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹1.1 |
| MYSQL\_DATABASE          | MySQLæ•°æ®åº“å        | crystal_erp            | ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹1.1 |

#### 1.2 PM2 é…ç½®ï¼ˆæå–è‡ªã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹8.2.2ï¼‰

```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: "crystal-erp-backend",
    script: "src/server.js",
    instances: "max", // æœ€å¤§åŒ–åˆ©ç”¨CPU
    autorestart: true,
    watch: false,
    max_memory_restart: "1G",
    log_date_format: "YYYY-MM-DD HH:mm:ss",
    // æ—¥å¿—è·¯å¾„ç»Ÿä¸€ï¼ˆç»å¯¹è·¯å¾„ï¼‰
    out_file: "/home/crystal-erp/logs/out.log",
    error_file: "/home/crystal-erp/logs/error.log",
    env: {
      NODE_ENV: "production",
      PORT: 3001
    }
  }]
};
```

#### 1.3 é»˜è®¤æµ‹è¯•è´¦å·é…ç½®

**å¼€å‘ç¯å¢ƒæµ‹è¯•è´¦å·**ï¼ˆä»…å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä½¿ç”¨ï¼‰ï¼š

| è§’è‰² | ç”¨æˆ·å | å¯†ç  | æƒé™è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|--------|------|----------|----------|
| è€æ¿ | boss | 123456 | å®Œæ•´ç³»ç»Ÿæƒé™ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ | åŠŸèƒ½æµ‹è¯•ã€æƒé™éªŒè¯ |
| é›‡å‘˜ | employee | 123456 | å—é™æƒé™ï¼Œæ— æ³•æŸ¥çœ‹ä»·æ ¼ç­‰æ•æ„Ÿä¿¡æ¯ | æƒé™æ§åˆ¶æµ‹è¯• |

**é‡è¦è¯´æ˜**ï¼š
- æµ‹è¯•è´¦å·ä¿¡æ¯ç¡¬ç¼–ç åœ¨å‰ç«¯ç™»å½•é¡µé¢ï¼ˆ`src/pages/Login.tsx`ï¼‰
- ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒåº”éšè—æˆ–ç§»é™¤
- ç”Ÿäº§éƒ¨ç½²å‰å¿…é¡»ä¿®æ”¹é»˜è®¤å¯†ç æˆ–ç¦ç”¨æµ‹è¯•è´¦å·
- æµ‹è¯•è´¦å·ç”±æ•°æ®åº“ç§å­æ–‡ä»¶ï¼ˆ`prisma/seed.ts`ï¼‰è‡ªåŠ¨åˆ›å»º

**ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®**ï¼š
```javascript
// ç”Ÿäº§ç¯å¢ƒåº”ç§»é™¤æˆ–éšè—æµ‹è¯•è´¦å·æç¤º
if (process.env.NODE_ENV !== 'production') {
  // æ˜¾ç¤ºæµ‹è¯•è´¦å·ä¿¡æ¯
}
```

### äºŒã€æ•°æ®åº“è¿ç»´ï¼ˆæå–è‡ªã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹9 ç« ï¼‰

#### 2.1 è‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼ˆç°æœ‰é€»è¾‘ï¼‰

```bash
#!/bin/bash
# backup-mysql.shï¼ˆæ¯æ—¥2ç‚¹æ‰§è¡Œï¼‰
# æ‰§è¡Œè¦æ±‚ï¼š1. æœ¬åœ°ç”¨æˆ·æœ‰/home/backup/mysqlå†™å…¥æƒé™ï¼ˆchmod 755ï¼‰ï¼›2. RDSå…å¯†ç™»å½•ï¼ˆ~/.my.cnfï¼‰
BACKUP_DIR="/home/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“ï¼ˆæ›¿æ¢ä¸ºå®é™…RDSåœ°å€ï¼‰
mysqldump -h rm-xxxxx.mysql.rds.aliyuncs.com -u username -p'password' crystal_erp > $BACKUP_DIR/erp_backup_$DATE.sql

# å‹ç¼©
gzip $BACKUP_DIR/erp_backup_$DATE.sql

# ä¿ç•™30å¤©å¤‡ä»½
find $BACKUP_DIR -name "erp_backup_*.sql.gz" -mtime +30 -delete

# æ—¥å¿—ï¼ˆä¸PM2æ—¥å¿—è·¯å¾„ç»Ÿä¸€ï¼‰
echo "$(date): Backup completed - erp_backup_$DATE.sql.gz" >> /home/crystal-erp/logs/backup.log
```

#### 2.2 Crontab é…ç½®

```bash
# æ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½
0 2 * * * /home/scripts/backup-mysql.sh
# æ¯å°æ—¶æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
0 * * * * curl -s http://localhost:3001/api/v1/health > /dev/null
```

### ä¸‰ã€é˜¿é‡Œäº‘éƒ¨ç½²é…ç½®

#### 3.1 å®å¡”é¢æ¿Nodeé¡¹ç›®é…ç½®

```bash
# 1. å®å¡”é¢æ¿ -> ç½‘ç«™ -> Nodeé¡¹ç›® -> æ·»åŠ Nodeé¡¹ç›®
é¡¹ç›®åç§°: crystal-erp
é¡¹ç›®åŸŸå: api.dorblecapital.com
é¡¹ç›®ç›®å½•: /www/wwwroot/crystal-erp
å¯åŠ¨æ–‡ä»¶: src/server.js
Nodeç‰ˆæœ¬: 22.17.1
ç«¯å£: 3001

# 2. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå®å¡”é¢æ¿ -> Nodeé¡¹ç›® -> ç¯å¢ƒå˜é‡ï¼‰
NODE_ENV=production
PORT=3001
DOUBAO_API_KEY=0a7c42e7-d1d3-4d53-9b83-dca43b9b2c81
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_mysql_password
MYSQL_DATABASE=crystal_erp
```

#### 3.2 é˜¿é‡Œäº‘ECSå®‰å…¨ç»„é…ç½®

```bash
# éœ€è¦å¼€æ”¾çš„ç«¯å£
22    # SSH
80    # HTTP
443   # HTTPS
3001  # Node.jsåç«¯API
3306  # MySQLï¼ˆä»…å†…ç½‘è®¿é—®ï¼‰

# å®‰å…¨ç»„è§„åˆ™ç¤ºä¾‹
å…¥æ–¹å‘è§„åˆ™:
- åè®®: TCP, ç«¯å£: 22, æº: 0.0.0.0/0 (SSHè®¿é—®)
- åè®®: TCP, ç«¯å£: 80, æº: 0.0.0.0/0 (HTTPè®¿é—®)
- åè®®: TCP, ç«¯å£: 443, æº: 0.0.0.0/0 (HTTPSè®¿é—®)
- åè®®: TCP, ç«¯å£: 3001, æº: 0.0.0.0/0 (APIè®¿é—®)
```

#### 3.3 åŸŸåè§£æé…ç½®

```bash
# é˜¿é‡Œäº‘DNSè§£æé…ç½®
ä¸»åŸŸå: dorblecapital.com
APIå­åŸŸå: api.dorblecapital.com

# DNSè®°å½•é…ç½®
è®°å½•ç±»å‹: A
ä¸»æœºè®°å½•: api
è®°å½•å€¼: 139.224.189.1 (å…¬ç½‘IP)
TTL: 600
```

#### 3.4 Gitéƒ¨ç½²æµç¨‹

```bash
# 1. æœ¬åœ°æ¨é€åˆ°GitHub
git add .
git commit -m "éƒ¨ç½²æ›´æ–°"
git push origin main

# 2. æœåŠ¡å™¨æ‹‰å–æ›´æ–°
cd /www/wwwroot/crystal-erp
git pull origin main
npm install --production

# 3. é‡å¯Nodeé¡¹ç›®ï¼ˆå®å¡”é¢æ¿æ“ä½œï¼‰
# å®å¡”é¢æ¿ -> ç½‘ç«™ -> Nodeé¡¹ç›® -> crystal-erp -> é‡å¯
```

### å››ã€OSS éƒ¨ç½²ï¼ˆæå–è‡ªã€Šç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€‹2.3.2ï¼‰

```javascript
// åç«¯Multer-OSSé…ç½®ï¼ˆç°æœ‰é€»è¾‘ï¼‰
const multer = require('multer');
const multerAliOSS = require('multer-aliyun-oss');

const upload = multer({
  storage: multerAliOSS({
    config: {
      region: process.env.OSS_REGION,
      accessKeyId: process.env.OSS_ACCESS_KEY_ID, // ç¦æ­¢ç¡¬ç¼–ç 
      accessKeySecret: process.env.OSS_ACCESS_KEY_SECRET,
      bucket: process.env.OSS_BUCKET
    }
  }),
  limits: {
    fileSize: 5 * 1024 * 1024 // 5MBé™åˆ¶
  }
});
```

### äº”ã€ç½‘ç»œç¯å¢ƒé…ç½®

### äº”ã€å›¾ç‰‡æ–‡ä»¶è¿ç»´è§„èŒƒ

#### 5.1 å›¾ç‰‡æ–‡ä»¶å­˜å‚¨ç®¡ç†

**ç›®å½•ç»“æ„è§„èŒƒï¼š**
```bash
/www/wwwroot/crystal-erp/backend/uploads/
â”œâ”€â”€ purchases/          # é‡‡è´­è®°å½•å›¾ç‰‡
â”‚   â”œâ”€â”€ 1756102840000_47.jpg
â”‚   â”œâ”€â”€ 1756227752158_158.png
â”‚   â””â”€â”€ ...
â””â”€â”€ temp/              # ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶
```

**æ–‡ä»¶æƒé™é…ç½®ï¼š**
```bash
# è®¾ç½®uploadsç›®å½•æƒé™
chmod 755 /www/wwwroot/crystal-erp/backend/uploads
chmod 644 /www/wwwroot/crystal-erp/backend/uploads/purchases/*

# ç¡®ä¿Node.jsè¿›ç¨‹æœ‰è¯»å†™æƒé™
chown -R www:www /www/wwwroot/crystal-erp/backend/uploads
```

#### 5.2 å›¾ç‰‡å®Œæ•´æ€§æ£€æŸ¥è„šæœ¬

**æ‰¹é‡æ£€æŸ¥è„šæœ¬ï¼ˆcheck-image-integrity.jsï¼‰ï¼š**
```javascript
// å®šæœŸæ‰§è¡Œçš„å›¾ç‰‡å®Œæ•´æ€§æ£€æŸ¥è„šæœ¬
// ä½¿ç”¨æ–¹æ³•ï¼šnode check-image-integrity.js
// å»ºè®®æ¯æ—¥æ‰§è¡Œä¸€æ¬¡

import mysql from 'mysql2/promise';
import fs from 'fs';
import path from 'path';

// æ£€æŸ¥JPEGæ–‡ä»¶å®Œæ•´æ€§
function checkJpegIntegrity(filePath) {
  const buffer = fs.readFileSync(filePath);
  
  // æ£€æŸ¥æ–‡ä»¶å¤´ (FF D8)
  if (buffer[0] !== 0xFF || buffer[1] !== 0xD8) {
    return { valid: false, reason: 'JPEGæ–‡ä»¶å¤´æ— æ•ˆ' };
  }
  
  // æ£€æŸ¥æ–‡ä»¶å°¾ (FF D9)
  const lastTwo = buffer.slice(-2);
  if (lastTwo[0] !== 0xFF || lastTwo[1] !== 0xD9) {
    return { valid: false, reason: 'JPEGæ–‡ä»¶å°¾æ— æ•ˆ' };
  }
  
  return { valid: true, reason: 'æ–‡ä»¶å®Œæ•´' };
}

// æ‰¹é‡ä¿®å¤æŸåå›¾ç‰‡
async function batchFixCorruptedImages() {
  // 1. æŸ¥è¯¢æ‰€æœ‰é‡‡è´­è®°å½•çš„å›¾ç‰‡
  // 2. æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶å®Œæ•´æ€§
  // 3. æ›¿æ¢æŸåçš„å›¾ç‰‡
  // 4. æ›´æ–°æ•°æ®åº“è®°å½•
  // 5. ç”Ÿæˆä¿®å¤æŠ¥å‘Š
}
```

**Crontabå®šæ—¶ä»»åŠ¡é…ç½®ï¼š**
```bash
# æ¯æ—¥å‡Œæ™¨3ç‚¹æ‰§è¡Œå›¾ç‰‡å®Œæ•´æ€§æ£€æŸ¥
0 3 * * * cd /www/wwwroot/crystal-erp/backend && node check-image-integrity.js >> /home/crystal-erp/logs/image-check.log 2>&1

# æ¯å‘¨å‡Œæ™¨4ç‚¹æ‰§è¡Œå›¾ç‰‡æ¸…ç†ï¼ˆåˆ é™¤æœªä½¿ç”¨çš„å›¾ç‰‡æ–‡ä»¶ï¼‰
0 4 * * 0 cd /www/wwwroot/crystal-erp/backend && node cleanup-unused-images.js >> /home/crystal-erp/logs/image-cleanup.log 2>&1
```

#### 5.3 å›¾ç‰‡å¤‡ä»½ç­–ç•¥

**å›¾ç‰‡æ–‡ä»¶å¤‡ä»½è„šæœ¬ï¼š**
```bash
#!/bin/bash
# backup-images.sh - å›¾ç‰‡æ–‡ä»¶å¤‡ä»½è„šæœ¬
BACKUP_DIR="/home/backup/images"
SOURCE_DIR="/www/wwwroot/crystal-erp/backend/uploads"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å‹ç¼©å¤‡ä»½å›¾ç‰‡æ–‡ä»¶
tar -czf $BACKUP_DIR/images_backup_$DATE.tar.gz -C $SOURCE_DIR .

# ä¿ç•™30å¤©å¤‡ä»½
find $BACKUP_DIR -name "images_backup_*.tar.gz" -mtime +30 -delete

# è®°å½•æ—¥å¿—
echo "$(date): Images backup completed - images_backup_$DATE.tar.gz" >> /home/crystal-erp/logs/backup.log
```

#### 5.4 å›¾ç‰‡URLç¯å¢ƒé€‚é…

**å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒURLåˆ‡æ¢ï¼š**
```javascript
// ç¯å¢ƒå˜é‡é…ç½®
// å¼€å‘ç¯å¢ƒ (.env.development)
IMAGE_BASE_URL=http://localhost:3001

// ç”Ÿäº§ç¯å¢ƒ (.env.production)
IMAGE_BASE_URL=http://api.dorblecapital.com

// åŠ¨æ€IPæ£€æµ‹å’ŒURLæ›´æ–°
function updateImageUrls(oldIP, newIP) {
  // 1. æŸ¥è¯¢æ•°æ®åº“ä¸­æ‰€æœ‰åŒ…å«æ—§IPçš„å›¾ç‰‡URL
  // 2. æ‰¹é‡æ›¿æ¢ä¸ºæ–°IP
  // 3. æ›´æ–°æ•°æ®åº“è®°å½•
  // 4. è®°å½•æ›´æ–°æ—¥å¿—
}
```

#### 5.5 CORSè·¨åŸŸé—®é¢˜è§£å†³æ–¹æ¡ˆ

**é—®é¢˜ç°è±¡ï¼š**
- æµè§ˆå™¨æ§åˆ¶å°å‡ºç° `net::ERR_BLOCKED_BY_RESPONSE.NotSameOrigin` é”™è¯¯
- å›¾ç‰‡æ˜¾ç¤ºä¸ºå‰å‰æˆ–æ— æ³•åŠ è½½
- æ•°æ®åº“ä¸­å­˜å‚¨çš„æ˜¯ç”Ÿäº§ç¯å¢ƒURLï¼ˆapi.dorblecapital.comï¼‰ï¼Œæœ¬åœ°å¼€å‘æ—¶æ— æ³•è®¿é—®

**æ ¹æœ¬åŸå› ï¼š**
- æ•°æ®åº“ä¸­å­˜å‚¨çš„å›¾ç‰‡URLæŒ‡å‘ç”Ÿäº§ç¯å¢ƒåŸŸå
- æœ¬åœ°å¼€å‘ç¯å¢ƒæ— æ³•è·¨åŸŸè®¿é—®ç”Ÿäº§ç¯å¢ƒçš„å›¾ç‰‡èµ„æº
- ç¼ºå°‘ç¯å¢ƒé€‚é…çš„URLè½¬æ¢æœºåˆ¶

**è§£å†³æ–¹æ¡ˆï¼ˆfixImageUrlå‡½æ•°å¢å¼ºï¼‰ï¼š**
```javascript
// src/services/api.ts ä¸­çš„ fixImageUrl å‡½æ•°
export const fixImageUrl = (url: string): string => {
  if (!url) return url
  
  // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›´æ¥è¿”å›
  if (!url.startsWith('http')) return url
  
  // è·å–å½“å‰ä¸»æœºå
  const currentHostname = typeof window !== 'undefined' ? window.location.hostname : 'localhost'
  
  // å¤„ç†ç”Ÿäº§ç¯å¢ƒåŸŸååœ¨æœ¬åœ°å¼€å‘æ—¶çš„è½¬æ¢
  if (url.includes('api.dorblecapital.com')) {
    // åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼Œå°†ç”Ÿäº§ç¯å¢ƒçš„å›¾ç‰‡URLè½¬æ¢ä¸ºæœ¬åœ°åœ°å€
    if (currentHostname === 'localhost' || currentHostname === '127.0.0.1') {
      const newUrl = url.replace(/https?:\/\/api\.dorblecapital\.com/g, 'http://localhost:3001')
      console.log(`ğŸ”„ ç”Ÿäº§ç¯å¢ƒå›¾ç‰‡URLå·²è½¬æ¢ä¸ºæœ¬åœ°: ${url} -> ${newUrl}`)
      return newUrl
    }
    // å¦‚æœå½“å‰æ˜¯å±€åŸŸç½‘IPï¼Œè½¬æ¢ä¸ºå¯¹åº”çš„å±€åŸŸç½‘åœ°å€
    else if (currentHostname.startsWith('192.168.') || currentHostname.startsWith('10.') || 
             (currentHostname.startsWith('172.') && parseInt(currentHostname.split('.')[1]) >= 16 && parseInt(currentHostname.split('.')[1]) <= 31)) {
      const newUrl = url.replace(/https?:\/\/api\.dorblecapital\.com/g, `http://${currentHostname}:3001`)
      console.log(`ğŸ”„ ç”Ÿäº§ç¯å¢ƒå›¾ç‰‡URLå·²è½¬æ¢ä¸ºå±€åŸŸç½‘: ${url} -> ${newUrl}`)
      return newUrl
    }
  }
  
  // å…¶ä»–IPåœ°å€è½¬æ¢é€»è¾‘...
  return url
}
```

**é¢„é˜²æªæ–½ï¼š**
1. **å¼€å‘é˜¶æ®µ**ï¼š
   - ç¡®ä¿æ‰€æœ‰å›¾ç‰‡URLå¤„ç†éƒ½é€šè¿‡fixImageUrlå‡½æ•°
   - åœ¨å›¾ç‰‡ç»„ä»¶ä¸­ç»Ÿä¸€ä½¿ç”¨URLè½¬æ¢é€»è¾‘
   - å®šæœŸæ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰CORSé”™è¯¯

2. **æµ‹è¯•é˜¶æ®µ**ï¼š
   - åœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹æµ‹è¯•å›¾ç‰‡æ˜¾ç¤º
   - éªŒè¯æœ¬åœ°å¼€å‘ã€å±€åŸŸç½‘ã€ç”Ÿäº§ç¯å¢ƒçš„URLè½¬æ¢
   - æ£€æŸ¥å›¾ç‰‡åŠ è½½æ€§èƒ½å’Œé”™è¯¯å¤„ç†

3. **éƒ¨ç½²é˜¶æ®µ**ï¼š
   - ç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„å›¾ç‰‡æœåŠ¡æ­£å¸¸è¿è¡Œ
   - é…ç½®æ­£ç¡®çš„CORSç­–ç•¥ï¼ˆå¦‚éœ€è¦ï¼‰
   - ç›‘æ§å›¾ç‰‡è®¿é—®å¼‚å¸¸å’ŒåŠ è½½å¤±è´¥

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] fixImageUrlå‡½æ•°æ˜¯å¦åŒ…å«æ‰€æœ‰åŸŸåè½¬æ¢é€»è¾‘
- [ ] å›¾ç‰‡ç»„ä»¶æ˜¯å¦ç»Ÿä¸€ä½¿ç”¨URLè½¬æ¢
- [ ] æ§åˆ¶å°æ˜¯å¦æœ‰CORSç›¸å…³é”™è¯¯
- [ ] ä¸åŒç¯å¢ƒä¸‹å›¾ç‰‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- [ ] å›¾ç‰‡URLè½¬æ¢æ—¥å¿—æ˜¯å¦æ­£å¸¸è¾“å‡º

#### 5.5 å›¾ç‰‡æ€§èƒ½ä¼˜åŒ–

**å›¾ç‰‡å‹ç¼©å’Œä¼˜åŒ–ï¼š**
```bash
# å®‰è£…å›¾ç‰‡ä¼˜åŒ–å·¥å…·
npm install sharp imagemin imagemin-mozjpeg imagemin-pngquant

# æ‰¹é‡å‹ç¼©ç°æœ‰å›¾ç‰‡
node optimize-images.js
```

**CDNé…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š**
```javascript
// é˜¿é‡Œäº‘CDNé…ç½®
const CDN_BASE_URL = 'https://cdn.dorblecapital.com';

// å›¾ç‰‡URLç”Ÿæˆ
function generateImageUrl(filename) {
  if (process.env.NODE_ENV === 'production' && process.env.USE_CDN === 'true') {
    return `${CDN_BASE_URL}/uploads/purchases/${filename}`;
  }
  return `${process.env.IMAGE_BASE_URL}/uploads/purchases/${filename}`;
}
```

### å…­ã€ç½‘ç»œç¯å¢ƒé…ç½®

#### 6.1 åŠ¨æ€IPæ£€æµ‹é…ç½®

```javascript
// å‰ç«¯ç½‘ç»œæ£€æµ‹é…ç½®
const NETWORK_ENDPOINTS = {
  production: 'https://api.dorblecapital.com/api/v1',
  local: 'http://localhost:3001/api/v1',
  publicIP: 'http://139.224.189.1:3001/api/v1'
};

// è‡ªåŠ¨æ£€æµ‹æœ€ä½³ç«¯ç‚¹
const detectBestEndpoint = async () => {
  const endpoints = Object.values(NETWORK_ENDPOINTS);
  
  for (const endpoint of endpoints) {
    try {
      const response = await fetch(`${endpoint}/health`, { 
        method: 'GET',
        timeout: 3000 
      });
      if (response.ok) {
        return endpoint;
      }
    } catch (error) {
      console.warn(`ç«¯ç‚¹ ${endpoint} è¿æ¥å¤±è´¥:`, error.message);
    }
  }
  
  throw new Error('æ‰€æœ‰APIç«¯ç‚¹å‡ä¸å¯ç”¨');
};
```

#### 5.2 æ‰‹æœºç«¯æµ‹è¯•é…ç½®

```bash
# æ‰‹æœºç«¯è®¿é—®é…ç½®
# ç¡®ä¿æ‰‹æœºå’Œå¼€å‘æœºåœ¨åŒä¸€å±€åŸŸç½‘
# ä½¿ç”¨å…¬ç½‘IPæˆ–å±€åŸŸç½‘IPè®¿é—®

# å¼€å‘ç¯å¢ƒ
APIåœ°å€: http://192.168.1.100:3001/api/v1 (å±€åŸŸç½‘IP)
å‰ç«¯åœ°å€: http://192.168.1.100:5173

# ç”Ÿäº§ç¯å¢ƒ
APIåœ°å€: https://api.dorblecapital.com/api/v1
å‰ç«¯åœ°å€: https://dorblecapital.com
```

## å…­ã€ä»£ç ç»´æŠ¤ä¸å·¥å…·ä½¿ç”¨è§„èŒƒ

### 6.1 æ‰¹é‡è½¬æ¢å·¥å…·ä½¿ç”¨è§„èŒƒ

**å·¥å…·ä½¿ç”¨åŸåˆ™ï¼š**
- å®‰å…¨ç¬¬ä¸€ï¼Œè´¨é‡è‡³ä¸Š
- ä¸¥æ ¼æŒ‰æ–‡æ¡£è§„èŒƒæ‰§è¡Œ
- å°æ­¥å¿«è·‘ï¼ŒåŠæ—¶éªŒè¯
- å‘ç°é—®é¢˜ç«‹å³åœæ­¢

**ä½¿ç”¨å‰å‡†å¤‡ï¼š**
```bash
# 1. ç¡®ä¿å·¥ä½œåŒºå¹²å‡€
git status
git add .
git commit -m "å­—æ®µè½¬æ¢å‰å¤‡ä»½ - $(date)"

# 2. æ£€æŸ¥å·¥å…·æ’é™¤è§„åˆ™
node scripts/convert-camel-to-snake.cjs --check-rules

# 3. é¢„è§ˆè½¬æ¢ç»“æœ
node scripts/convert-camel-to-snake.cjs --preview --verbose
```

**åˆ†æ‰¹è½¬æ¢æµç¨‹ï¼š**
```bash
# æŒ‰æ¨¡å—åˆ†æ‰¹è½¬æ¢ï¼Œæ¯æ¬¡è½¬æ¢åç«‹å³éªŒè¯
node scripts/convert-camel-to-snake.cjs --directory src/types
npm run build  # ç«‹å³æ£€æŸ¥ç¼–è¯‘

node scripts/convert-camel-to-snake.cjs --directory src/api
npm run build  # ç«‹å³æ£€æŸ¥ç¼–è¯‘

node scripts/convert-camel-to-snake.cjs --directory src/components
npm run build  # ç«‹å³æ£€æŸ¥ç¼–è¯‘
```

**è½¬æ¢åéªŒè¯ï¼š**
```bash
# å®Œæ•´éªŒè¯æµç¨‹
npm run build
npx tsc --noEmit
npm run lint
npm run dev  # æ‰‹åŠ¨æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
```

**é—®é¢˜å›æ»šï¼š**
```bash
# å‘ç°é—®é¢˜ç«‹å³å›æ»š
git reset --hard HEAD~1
```

### 6.2 ä»£ç è´¨é‡ä¿è¯æœºåˆ¶

**æäº¤å‰æ£€æŸ¥ï¼š**
- ä»£ç ç¼–è¯‘é€šè¿‡
- ç±»å‹æ£€æŸ¥æ— é”™è¯¯
- æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•æ­£å¸¸
- æ— æ˜æ˜¾æ€§èƒ½é—®é¢˜

**å›¢é˜Ÿåä½œè§„èŒƒï¼š**
- è½¬æ¢å‰å›¢é˜Ÿé€šçŸ¥
- è½¬æ¢æœŸé—´ä»£ç å†»ç»“
- è½¬æ¢åç»éªŒæ€»ç»“
- é—®é¢˜è®°å½•å’Œæ”¹è¿›

### 6.3 å·¥å…·å®‰å…¨æœºåˆ¶

**æ™ºèƒ½ä¿æŠ¤ï¼š**
- è‡ªåŠ¨è¯†åˆ«JavaScriptå†…ç½®æ–¹æ³•
- è‡ªåŠ¨è¯†åˆ«Reactç»„ä»¶å±æ€§
- è‡ªåŠ¨è¯†åˆ«CSSå±æ€§å
- è‡ªåŠ¨è¯†åˆ«ç¬¬ä¸‰æ–¹åº“API

**å®‰å…¨æ£€æŸ¥ï¼š**
- è½¬æ¢å‰æ–‡ä»¶å†…å®¹æ‰«æ
- é£é™©æ¨¡å¼è‡ªåŠ¨æ£€æµ‹
- äº¤äº’å¼ç¡®è®¤æœºåˆ¶
- å®æ—¶ç¼–è¯‘éªŒè¯

## ç»“è¯­

æœ¬æ–‡æ¡£æä¾›äº†æ°´æ™¶ERPç³»ç»Ÿåœ¨é˜¿é‡Œäº‘ç¯å¢ƒä¸‹çš„å®Œæ•´éƒ¨ç½²å’Œè¿ç»´æŒ‡å—ã€‚é€šè¿‡éµå¾ªè¿™äº›è§„èŒƒï¼Œå¯ä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€æ•°æ®å®‰å…¨å’Œé«˜æ•ˆç»´æŠ¤ã€‚

åœ¨å®é™…æ“ä½œä¸­ï¼Œå»ºè®®ï¼š
1. ä¸¥æ ¼æŒ‰ç…§æ–‡æ¡£æ­¥éª¤æ‰§è¡Œ
2. åšå¥½æ¯ä¸ªç¯èŠ‚çš„å¤‡ä»½
3. åŠæ—¶æ›´æ–°æ–‡æ¡£å†…å®¹
4. å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
5. å®šæœŸè¿›è¡Œå®‰å…¨æ£€æŸ¥
6. è°¨æ…ä½¿ç”¨æ‰¹é‡è½¬æ¢å·¥å…·
7. æŒç»­æ”¹è¿›å¼€å‘æµç¨‹

é€šè¿‡æŒç»­çš„ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œè®©æ°´æ™¶ERPç³»ç»Ÿä¸ºä¸šåŠ¡å‘å±•æä¾›å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚

## 6. SKUç³»ç»Ÿéƒ¨ç½²è¦æ±‚

### 6.1 SKUæ•°æ®åº“éƒ¨ç½²

#### 6.1.1 SKUç›¸å…³è¡¨ç»“æ„éƒ¨ç½²

**å¿…éœ€çš„æ•°æ®åº“è¡¨ï¼š**
- `product_skus` - SKUä¸»è¡¨
- `sku_inventory_logs` - SKUåº“å­˜å˜æ›´æ—¥å¿—è¡¨
- `material_usages` - åŸææ–™ä½¿ç”¨è®°å½•è¡¨ï¼ˆå…³è”SKUç”Ÿæˆï¼‰

**éƒ¨ç½²è„šæœ¬ï¼š**
```sql
-- SKUä¸»è¡¨åˆ›å»º
CREATE TABLE product_skus (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    sku_code VARCHAR(50) UNIQUE NOT NULL,
    sku_name VARCHAR(200) NOT NULL,
    material_signature_hash VARCHAR(8) NOT NULL,
    total_quantity INT NOT NULL DEFAULT 0,
    available_quantity INT NOT NULL DEFAULT 0,
    material_cost DECIMAL(10,2),
    labor_cost DECIMAL(10,2),
    craft_cost DECIMAL(10,2),
    total_cost DECIMAL(10,2),
    unit_price DECIMAL(10,2),
    total_value DECIMAL(10,2),
    profit_margin DECIMAL(5,2),
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- SKUåº“å­˜å˜æ›´æ—¥å¿—è¡¨åˆ›å»º
CREATE TABLE sku_inventory_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    sku_id UUID NOT NULL,
    action ENUM('CREATE', 'SELL', 'ADJUST') NOT NULL,
    quantity_change INT NOT NULL,
    quantity_before INT NOT NULL,
    quantity_after INT NOT NULL,
    reference_type ENUM('PRODUCT', 'SALE', 'MANUAL') NOT NULL,
    reference_id UUID,
    notes TEXT,
    user_id UUID NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    
    FOREIGN KEY (sku_id) REFERENCES product_skus(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_product_skus_material_hash ON product_skus(material_signature_hash);
CREATE INDEX idx_product_skus_status ON product_skus(status);
CREATE INDEX idx_product_skus_created_at ON product_skus(created_at DESC);
CREATE INDEX idx_sku_inventory_logs_sku_id ON sku_inventory_logs(sku_id);
CREATE INDEX idx_sku_inventory_logs_created_at ON sku_inventory_logs(created_at DESC);
CREATE INDEX idx_sku_inventory_logs_action ON sku_inventory_logs(action);
```

#### 6.1.2 SKUæƒé™é…ç½®

**æ•°æ®åº“æƒé™è®¾ç½®ï¼š**
```sql
-- ä¸ºåº”ç”¨ç”¨æˆ·æˆæƒSKUç›¸å…³è¡¨æƒé™
GRANT SELECT, INSERT, UPDATE, DELETE ON product_skus TO erp_app_user;
GRANT SELECT, INSERT, UPDATE, DELETE ON sku_inventory_logs TO erp_app_user;

-- ä¸ºåªè¯»ç”¨æˆ·æˆæƒæŸ¥è¯¢æƒé™
GRANT SELECT ON product_skus TO erp_readonly_user;
GRANT SELECT ON sku_inventory_logs TO erp_readonly_user;
```

### 6.2 SKU APIæœåŠ¡éƒ¨ç½²

#### 6.2.1 SKUè·¯ç”±é…ç½®

**å¿…éœ€çš„APIè·¯ç”±ï¼š**
- `GET /api/v1/skus` - SKUåˆ—è¡¨æŸ¥è¯¢
- `GET /api/v1/skus/:id` - SKUè¯¦æƒ…æŸ¥è¯¢
- `PUT /api/v1/skus/:id/adjust` - SKUåº“å­˜è°ƒæ•´
- `POST /api/v1/skus/:id/sell` - SKUé”€å”®è®°å½•
- `GET /api/v1/skus/:id/history` - SKUå˜æ›´å†å²
- `GET /api/v1/skus/statistics` - SKUç»Ÿè®¡ä¿¡æ¯

**è·¯ç”±æ–‡ä»¶éƒ¨ç½²ï¼š**
```bash
# ç¡®ä¿SKUè·¯ç”±æ–‡ä»¶å­˜åœ¨
ls -la backend/src/routes/skus.ts

# æ£€æŸ¥è·¯ç”±æ³¨å†Œ
grep -n "skus" backend/src/app.ts
```

#### 6.2.2 SKUæœåŠ¡ä¾èµ–

**å¿…éœ€çš„æœåŠ¡ä¾èµ–ï¼š**
- Prisma ORMï¼ˆæ•°æ®åº“æ“ä½œï¼‰
- JWTè®¤è¯ä¸­é—´ä»¶
- Zodæ•°æ®éªŒè¯
- é”™è¯¯å¤„ç†ä¸­é—´ä»¶

**ä¾èµ–æ£€æŸ¥è„šæœ¬ï¼š**
```bash
#!/bin/bash
# SKUæœåŠ¡ä¾èµ–æ£€æŸ¥

echo "æ£€æŸ¥SKUæœåŠ¡ä¾èµ–..."

# æ£€æŸ¥Prismaé…ç½®
if [ -f "backend/prisma/schema.prisma" ]; then
    echo "âœ“ Prismaé…ç½®æ–‡ä»¶å­˜åœ¨"
else
    echo "âœ— Prismaé…ç½®æ–‡ä»¶ç¼ºå¤±"
    exit 1
fi

# æ£€æŸ¥SKUæ¨¡å‹å®šä¹‰
if grep -q "model ProductSku" backend/prisma/schema.prisma; then
    echo "âœ“ SKUæ¨¡å‹å®šä¹‰å­˜åœ¨"
else
    echo "âœ— SKUæ¨¡å‹å®šä¹‰ç¼ºå¤±"
    exit 1
fi

# æ£€æŸ¥JWTä¸­é—´ä»¶
if [ -f "backend/src/middleware/auth.ts" ]; then
    echo "âœ“ JWTè®¤è¯ä¸­é—´ä»¶å­˜åœ¨"
else
    echo "âœ— JWTè®¤è¯ä¸­é—´ä»¶ç¼ºå¤±"
    exit 1
fi

echo "SKUæœåŠ¡ä¾èµ–æ£€æŸ¥å®Œæˆ"
```

### 6.3 SKUå‰ç«¯ç»„ä»¶éƒ¨ç½²

#### 6.3.1 é”€å”®åˆ—è¡¨é¡µé¢éƒ¨ç½²

**å¿…éœ€çš„å‰ç«¯æ–‡ä»¶ï¼š**
- `src/pages/SalesList.tsx` - é”€å”®åˆ—è¡¨ä¸»é¡µé¢
- `src/components/sku/SkuCard.tsx` - SKUå¡ç‰‡ç»„ä»¶
- `src/components/sku/SkuModal.tsx` - SKUè¯¦æƒ…å¼¹çª—
- `src/services/skuApi.ts` - SKU APIæœåŠ¡
- `src/types/sku.ts` - SKUç±»å‹å®šä¹‰

**ç»„ä»¶éƒ¨ç½²æ£€æŸ¥ï¼š**
```bash
#!/bin/bash
# SKUå‰ç«¯ç»„ä»¶æ£€æŸ¥

echo "æ£€æŸ¥SKUå‰ç«¯ç»„ä»¶..."

# æ£€æŸ¥ä¸»è¦ç»„ä»¶æ–‡ä»¶
components=(
    "src/pages/SalesList.tsx"
    "src/components/sku/SkuCard.tsx"
    "src/components/sku/SkuModal.tsx"
    "src/services/skuApi.ts"
    "src/types/sku.ts"
)

for component in "${components[@]}"; do
    if [ -f "$component" ]; then
        echo "âœ“ $component å­˜åœ¨"
    else
        echo "âœ— $component ç¼ºå¤±"
    fi
done

# æ£€æŸ¥è·¯ç”±é…ç½®
if grep -q "SalesList" src/App.tsx; then
    echo "âœ“ é”€å”®åˆ—è¡¨è·¯ç”±å·²é…ç½®"
else
    echo "âœ— é”€å”®åˆ—è¡¨è·¯ç”±æœªé…ç½®"
fi

echo "SKUå‰ç«¯ç»„ä»¶æ£€æŸ¥å®Œæˆ"
```

#### 6.3.2 SKUæƒé™æ§åˆ¶éƒ¨ç½²

**æƒé™æ§åˆ¶ç»„ä»¶ï¼š**
```typescript
// éƒ¨ç½²æ—¶ç¡®ä¿æƒé™æ§åˆ¶æ­£ç¡®å®ç°
const SkuPermissionCheck = () => {
  const { user } = useAuth();
  
  // æ£€æŸ¥ç”¨æˆ·è§’è‰²
  if (!user) {
    return <div>è¯·å…ˆç™»å½•</div>;
  }
  
  // EMPLOYEEè§’è‰²éšè—æ•æ„Ÿä¿¡æ¯
  const canViewSensitiveData = user.role === 'BOSS';
  
  return {
    canViewCost: canViewSensitiveData,
    canViewProfit: canViewSensitiveData,
    canViewSupplier: canViewSensitiveData
  };
};
```

### 6.4 SKUç³»ç»Ÿç¯å¢ƒé…ç½®

#### 6.4.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```bash
# .env.production
# SKUç³»ç»Ÿç›¸å…³é…ç½®
SKU_GENERATION_ENABLED=true
SKU_AUTO_MERGE_ENABLED=true
SKU_PRICE_TOLERANCE=0.05
SKU_LOW_STOCK_THRESHOLD=2
SKU_MAX_QUANTITY_PER_OPERATION=9999

# SKUæ—¥å¿—é…ç½®
SKU_LOG_RETENTION_DAYS=90
SKU_ERROR_LOG_ENABLED=true
SKU_PERFORMANCE_LOG_ENABLED=false

# SKUç¼“å­˜é…ç½®
SKU_CACHE_TTL=300
SKU_STATISTICS_CACHE_TTL=600
```

#### 6.4.2 å¼€å‘ç¯å¢ƒé…ç½®

**å¼€å‘ç¯å¢ƒç‰¹æ®Šé…ç½®ï¼š**
```bash
# .env.development
# SKUç³»ç»Ÿå¼€å‘é…ç½®
SKU_DEBUG_MODE=true
SKU_MOCK_DATA_ENABLED=false
SKU_VALIDATION_STRICT=true

# å¼€å‘è°ƒè¯•
SKU_LOG_LEVEL=debug
SKU_API_TIMEOUT=30000
SKU_RETRY_ATTEMPTS=3
```

### 6.5 SKUç³»ç»Ÿç›‘æ§éƒ¨ç½²

#### 6.5.1 SKUæ€§èƒ½ç›‘æ§

**ç›‘æ§æŒ‡æ ‡é…ç½®ï¼š**
```yaml
# monitoring/sku-metrics.yml
sku_metrics:
  # APIå“åº”æ—¶é—´ç›‘æ§
  api_response_time:
    - endpoint: "/api/v1/skus"
      threshold: 2000ms
    - endpoint: "/api/v1/skus/:id"
      threshold: 1000ms
    - endpoint: "/api/v1/skus/:id/adjust"
      threshold: 3000ms
  
  # æ•°æ®åº“æŸ¥è¯¢ç›‘æ§
  database_queries:
    - table: "product_skus"
      slow_query_threshold: 1000ms
    - table: "sku_inventory_logs"
      slow_query_threshold: 500ms
  
  # ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
  business_metrics:
    - metric: "sku_generation_rate"
      alert_threshold: 100
    - metric: "inventory_adjustment_frequency"
      alert_threshold: 1000
    - metric: "low_stock_sku_count"
      alert_threshold: 50
```

#### 6.5.2 SKUé”™è¯¯ç›‘æ§

**é”™è¯¯ç›‘æ§é…ç½®ï¼š**
```javascript
// monitoring/sku-error-tracking.js
const skuErrorTracking = {
  // é”™è¯¯åˆ†ç±»
  errorCategories: {
    'INSUFFICIENT_STOCK': 'business',
    'SKU_NOT_FOUND': 'data',
    'VALIDATION_ERROR': 'input',
    'PERMISSION_DENIED': 'security',
    'DATABASE_ERROR': 'system'
  },
  
  // å‘Šè­¦é˜ˆå€¼
  alertThresholds: {
    'business': 10, // 10ä¸ªä¸šåŠ¡é”™è¯¯/å°æ—¶
    'data': 5,      // 5ä¸ªæ•°æ®é”™è¯¯/å°æ—¶
    'input': 20,    // 20ä¸ªè¾“å…¥é”™è¯¯/å°æ—¶
    'security': 1,  // 1ä¸ªå®‰å…¨é”™è¯¯/å°æ—¶
    'system': 3     // 3ä¸ªç³»ç»Ÿé”™è¯¯/å°æ—¶
  },
  
  // é€šçŸ¥é…ç½®
  notifications: {
    email: ['admin@company.com'],
    slack: '#sku-alerts',
    webhook: 'https://hooks.slack.com/services/xxx'
  }
};
```

### 6.6 SKUç³»ç»Ÿå¤‡ä»½ç­–ç•¥

#### 6.6.1 SKUæ•°æ®å¤‡ä»½

**å¤‡ä»½è„šæœ¬ï¼š**
```bash
#!/bin/bash
# SKUæ•°æ®å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/sku"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="sku_backup_${DATE}.sql"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½SKUç›¸å…³è¡¨
pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME \
  --table=product_skus \
  --table=sku_inventory_logs \
  --table=material_usages \
  --data-only \
  --file="$BACKUP_DIR/$BACKUP_FILE"

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip "$BACKUP_DIR/$BACKUP_FILE"

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "sku_backup_*.sql.gz" -mtime +7 -delete

echo "SKUæ•°æ®å¤‡ä»½å®Œæˆ: $BACKUP_FILE.gz"
```

#### 6.6.2 SKUé…ç½®å¤‡ä»½

**é…ç½®æ–‡ä»¶å¤‡ä»½ï¼š**
```bash
#!/bin/bash
# SKUé…ç½®å¤‡ä»½è„šæœ¬

CONFIG_BACKUP_DIR="/backup/sku-config"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºé…ç½®å¤‡ä»½ç›®å½•
mkdir -p $CONFIG_BACKUP_DIR

# å¤‡ä»½SKUç›¸å…³é…ç½®æ–‡ä»¶
tar -czf "$CONFIG_BACKUP_DIR/sku_config_${DATE}.tar.gz" \
  backend/src/routes/skus.ts \
  backend/src/services/skuService.ts \
  src/pages/SalesList.tsx \
  src/services/skuApi.ts \
  src/types/sku.ts

echo "SKUé…ç½®å¤‡ä»½å®Œæˆ: sku_config_${DATE}.tar.gz"
```

### 6.7 SKUç³»ç»Ÿéƒ¨ç½²éªŒè¯

#### 6.7.1 éƒ¨ç½²ååŠŸèƒ½éªŒè¯

**éªŒè¯è„šæœ¬ï¼š**
```bash
#!/bin/bash
# SKUç³»ç»Ÿéƒ¨ç½²éªŒè¯è„šæœ¬

API_BASE_URL="${API_BASE_URL:-http://localhost:3001}"
TEST_TOKEN="your_test_token_here"

echo "å¼€å§‹SKUç³»ç»Ÿéƒ¨ç½²éªŒè¯..."

# 1. éªŒè¯SKUåˆ—è¡¨API
echo "éªŒè¯SKUåˆ—è¡¨API..."
response=$(curl -s -w "%{http_code}" -H "Authorization: Bearer $TEST_TOKEN" \
  "$API_BASE_URL/api/v1/skus?page=1&limit=10")

if [[ "$response" == *"200" ]]; then
    echo "âœ“ SKUåˆ—è¡¨APIæ­£å¸¸"
else
    echo "âœ— SKUåˆ—è¡¨APIå¼‚å¸¸: $response"
    exit 1
fi

# 2. éªŒè¯SKUç»Ÿè®¡API
echo "éªŒè¯SKUç»Ÿè®¡API..."
response=$(curl -s -w "%{http_code}" -H "Authorization: Bearer $TEST_TOKEN" \
  "$API_BASE_URL/api/v1/skus/statistics")

if [[ "$response" == *"200" ]]; then
    echo "âœ“ SKUç»Ÿè®¡APIæ­£å¸¸"
else
    echo "âœ— SKUç»Ÿè®¡APIå¼‚å¸¸: $response"
    exit 1
fi

# 3. éªŒè¯æ•°æ®åº“è¿æ¥
echo "éªŒè¯SKUæ•°æ®åº“è¡¨..."
psql -h $DB_HOST -U $DB_USER -d $DB_NAME -c "\dt product_skus" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ“ SKUæ•°æ®åº“è¡¨å­˜åœ¨"
else
    echo "âœ— SKUæ•°æ®åº“è¡¨ä¸å­˜åœ¨"
    exit 1
fi

# 4. éªŒè¯å‰ç«¯é¡µé¢
echo "éªŒè¯å‰ç«¯é”€å”®åˆ—è¡¨é¡µé¢..."
if [ -f "src/pages/SalesList.tsx" ]; then
    echo "âœ“ é”€å”®åˆ—è¡¨é¡µé¢æ–‡ä»¶å­˜åœ¨"
else
    echo "âœ— é”€å”®åˆ—è¡¨é¡µé¢æ–‡ä»¶ä¸å­˜åœ¨"
    exit 1
fi

echo "SKUç³»ç»Ÿéƒ¨ç½²éªŒè¯å®Œæˆï¼"
```

#### 6.7.2 æ€§èƒ½éªŒè¯

**æ€§èƒ½æµ‹è¯•è„šæœ¬ï¼š**
```bash
#!/bin/bash
# SKUç³»ç»Ÿæ€§èƒ½éªŒè¯

API_BASE_URL="${API_BASE_URL:-http://localhost:3001}"
TEST_TOKEN="your_test_token_here"

echo "å¼€å§‹SKUç³»ç»Ÿæ€§èƒ½éªŒè¯..."

# 1. SKUåˆ—è¡¨æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
echo "æµ‹è¯•SKUåˆ—è¡¨æŸ¥è¯¢æ€§èƒ½..."
start_time=$(date +%s%N)
curl -s -H "Authorization: Bearer $TEST_TOKEN" \
  "$API_BASE_URL/api/v1/skus?page=1&limit=50" > /dev/null
end_time=$(date +%s%N)
response_time=$(( (end_time - start_time) / 1000000 ))

if [ $response_time -lt 2000 ]; then
    echo "âœ“ SKUåˆ—è¡¨æŸ¥è¯¢å“åº”æ—¶é—´: ${response_time}ms (æ­£å¸¸)"
else
    echo "âš  SKUåˆ—è¡¨æŸ¥è¯¢å“åº”æ—¶é—´: ${response_time}ms (è¾ƒæ…¢)"
fi

# 2. SKUç»Ÿè®¡æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
echo "æµ‹è¯•SKUç»Ÿè®¡æŸ¥è¯¢æ€§èƒ½..."
start_time=$(date +%s%N)
curl -s -H "Authorization: Bearer $TEST_TOKEN" \
  "$API_BASE_URL/api/v1/skus/statistics" > /dev/null
end_time=$(date +%s%N)
response_time=$(( (end_time - start_time) / 1000000 ))

if [ $response_time -lt 1000 ]; then
    echo "âœ“ SKUç»Ÿè®¡æŸ¥è¯¢å“åº”æ—¶é—´: ${response_time}ms (æ­£å¸¸)"
else
    echo "âš  SKUç»Ÿè®¡æŸ¥è¯¢å“åº”æ—¶é—´: ${response_time}ms (è¾ƒæ…¢)"
fi

echo "SKUç³»ç»Ÿæ€§èƒ½éªŒè¯å®Œæˆï¼"
```

### 6.8 SKUç³»ç»Ÿéƒ¨ç½²æ¸…å•

#### 6.8.1 éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

**å¿…é¡»å®Œæˆçš„æ£€æŸ¥é¡¹ï¼š**
- [ ] æ•°æ®åº“è¡¨ç»“æ„å·²åˆ›å»ºï¼ˆproduct_skus, sku_inventory_logsï¼‰
- [ ] æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
- [ ] æ•°æ®åº“æƒé™å·²é…ç½®
- [ ] SKU APIè·¯ç”±å·²éƒ¨ç½²
- [ ] JWTè®¤è¯ä¸­é—´ä»¶å·²é…ç½®
- [ ] å‰ç«¯SKUç»„ä»¶å·²éƒ¨ç½²
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ç›‘æ§é…ç½®å·²éƒ¨ç½²
- [ ] å¤‡ä»½è„šæœ¬å·²é…ç½®
- [ ] é”™è¯¯å¤„ç†å·²å®ç°

#### 6.8.2 éƒ¨ç½²åéªŒè¯æ¸…å•

**å¿…é¡»éªŒè¯çš„åŠŸèƒ½ï¼š**
- [ ] SKUåˆ—è¡¨æŸ¥è¯¢æ­£å¸¸
- [ ] SKUè¯¦æƒ…æŸ¥è¯¢æ­£å¸¸
- [ ] SKUåº“å­˜è°ƒæ•´æ­£å¸¸
- [ ] SKUé”€å”®è®°å½•æ­£å¸¸
- [ ] SKUç»Ÿè®¡ä¿¡æ¯æ­£å¸¸
- [ ] æƒé™æ§åˆ¶æ­£å¸¸ï¼ˆBOSS/EMPLOYEEï¼‰
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] ç›‘æ§å‘Šè­¦æ­£å¸¸
- [ ] å¤‡ä»½åŠŸèƒ½æ­£å¸¸

#### 6.8.3 å›æ»šè®¡åˆ’

**å›æ»šæ­¥éª¤ï¼š**
1. **æ•°æ®åº“å›æ»š**ï¼š
   ```sql
   -- å¦‚éœ€å›æ»šSKUè¡¨ç»“æ„
   DROP TABLE IF EXISTS sku_inventory_logs;
   DROP TABLE IF EXISTS product_skus;
   ```

2. **ä»£ç å›æ»š**ï¼š
   ```bash
   # å›æ»šåˆ°éƒ¨ç½²å‰ç‰ˆæœ¬
   git checkout <previous_commit_hash>
   npm run build
   pm2 restart all
   ```

3. **é…ç½®å›æ»š**ï¼š
   ```bash
   # æ¢å¤ä¹‹å‰çš„é…ç½®æ–‡ä»¶
   cp /backup/config/previous_config.env .env
   ```

4. **éªŒè¯å›æ»š**ï¼š
   ```bash
   # éªŒè¯ç³»ç»ŸåŠŸèƒ½æ­£å¸¸
   ./scripts/health-check.sh
   ```

// ... existing code ...