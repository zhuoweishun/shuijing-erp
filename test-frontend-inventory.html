<!DOCTYPE html>
<html>
<head>
    <title>测试前端库存API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1565c0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>测试前端库存API</h1>
    
    <div>
        <button onclick="testHierarchicalAPI()">测试层级式库存API</button>
        <button onclick="testSemiFinishedAPI()">测试半成品库存API</button>
        <button onclick="testSearchAPI()">测试搜索黑闪灵</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        // 模拟认证token（需要替换为实际token）
        const AUTH_TOKEN = 'your-auth-token-here';
        
        function log(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            resultDiv.appendChild(div);
        }
        
        function logJSON(data, title) {
            const resultDiv = document.getElementById('result');
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `<strong>${title}</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
            resultDiv.appendChild(div);
        }
        
        async function testHierarchicalAPI() {
            log('开始测试层级式库存API...');
            
            try {
                const response = await fetch(`${API_BASE}/inventory/hierarchical`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AUTH_TOKEN}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('✅ 层级式库存API调用成功', 'success');
                    logJSON(data, '层级式库存API响应数据:');
                    
                    // 检查是否包含CG20250910578226
                    const hasTarget = JSON.stringify(data).includes('CG20250910578226');
                    log(`是否包含CG20250910578226: ${hasTarget ? '是' : '否'}`, hasTarget ? 'success' : 'error');
                    
                } else {
                    log(`❌ 层级式库存API调用失败: ${data.message}`, 'error');
                    logJSON(data, '错误响应:');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        async function testSemiFinishedAPI() {
            log('开始测试半成品库存API...');
            
            try {
                const params = new URLSearchParams({
                    product_types: 'LOOSE_BEADS,BRACELET',
                    page: '1',
                    limit: '20'
                });
                
                const response = await fetch(`${API_BASE}/inventory/hierarchical?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AUTH_TOKEN}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('✅ 半成品库存API调用成功', 'success');
                    logJSON(data, '半成品库存API响应数据:');
                    
                    // 检查是否包含CG20250910578226
                    const hasTarget = JSON.stringify(data).includes('CG20250910578226');
                    log(`是否包含CG20250910578226: ${hasTarget ? '是' : '否'}`, hasTarget ? 'success' : 'error');
                    
                    // 检查数据结构
                    if (data.data && data.data.hierarchy) {
                        log(`层级数据数量: ${data.data.hierarchy.length}`, 'success');
                    } else if (data.hierarchy) {
                        log(`层级数据数量: ${data.hierarchy.length}`, 'success');
                    } else {
                        log('未找到层级数据结构', 'error');
                    }
                    
                } else {
                    log(`❌ 半成品库存API调用失败: ${data.message}`, 'error');
                    logJSON(data, '错误响应:');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        async function testSearchAPI() {
            log('开始测试搜索黑闪灵...');
            
            try {
                const params = new URLSearchParams({
                    search: '黑闪灵',
                    product_types: 'LOOSE_BEADS,BRACELET',
                    page: '1',
                    limit: '20'
                });
                
                const response = await fetch(`${API_BASE}/inventory/hierarchical?${params}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AUTH_TOKEN}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('✅ 搜索API调用成功', 'success');
                    logJSON(data, '搜索API响应数据:');
                    
                    // 检查是否包含CG20250910578226
                    const hasTarget = JSON.stringify(data).includes('CG20250910578226');
                    log(`是否包含CG20250910578226: ${hasTarget ? '是' : '否'}`, hasTarget ? 'success' : 'error');
                    
                } else {
                    log(`❌ 搜索API调用失败: ${data.message}`, 'error');
                    logJSON(data, '错误响应:');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        // 页面加载时的提示
        window.onload = function() {
            log('页面加载完成。请注意：需要先登录获取有效的认证token才能测试API。');
            log('如果遇到认证错误，请先在浏览器中登录系统，然后从开发者工具中获取Authorization header。');
        };
    </script>
</body>
</html>