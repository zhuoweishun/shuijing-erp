<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试信息</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>前端调试信息</h1>
    
    <div class="section">
        <h2>认证状态</h2>
        <div id="auth-status"></div>
    </div>
    
    <div class="section">
        <h2>LocalStorage 信息</h2>
        <div id="localStorage-info"></div>
    </div>
    
    <div class="section">
        <h2>网络信息</h2>
        <div id="network-info"></div>
    </div>
    
    <div class="section">
        <h2>API 测试</h2>
        <button onclick="testAPI()">测试 API 连接</button>
        <div id="api-test-result"></div>
    </div>
    
    <div class="section">
        <h2>操作</h2>
        <button onclick="clearAuth()">清除认证信息</button>
        <button onclick="refreshPage()">刷新页面</button>
    </div>

    <script>
        // 显示认证状态
        function showAuthStatus() {
            const token = localStorage.getItem('auth_token');
            const user = localStorage.getItem('user_data');
            
            const authDiv = document.getElementById('auth-status');
            authDiv.innerHTML = `
                <p><strong>Token:</strong> ${token ? `${token.substring(0, 20)}...` : '<span class="error">未找到</span>'}</p>
                <p><strong>用户数据:</strong> ${user ? '<span class="success">存在</span>' : '<span class="error">未找到</span>'}</p>
                ${user ? `<pre>${JSON.stringify(JSON.parse(user), null, 2)}</pre>` : ''}
            `;
        }
        
        // 显示localStorage信息
        function showLocalStorageInfo() {
            const div = document.getElementById('localStorage-info');
            const items = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                items.push({ key, value: value?.substring(0, 100) + (value?.length > 100 ? '...' : '') });
            }
            
            div.innerHTML = `<pre>${JSON.stringify(items, null, 2)}</pre>`;
        }
        
        // 显示网络信息
        function showNetworkInfo() {
            const div = document.getElementById('network-info');
            div.innerHTML = `
                <p><strong>当前域名:</strong> ${window.location.hostname}</p>
                <p><strong>当前端口:</strong> ${window.location.port}</p>
                <p><strong>协议:</strong> ${window.location.protocol}</p>
                <p><strong>完整URL:</strong> ${window.location.href}</p>
                <p><strong>缓存IP:</strong> ${localStorage.getItem('cached_local_ip') || '未缓存'}</p>
            `;
        }
        
        // 测试API连接
        async function testAPI() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.innerHTML = '<p class="info">测试中...</p>';
            
            const apiUrl = 'http://localhost:3001/api/v1';
            const endpoints = [
                '/health',
                '/auth/verify',
                '/customers'
            ];
            
            const results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const token = localStorage.getItem('auth_token');
                    const headers = {
                        'Content-Type': 'application/json'
                    };
                    
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${apiUrl}${endpoint}`, {
                        method: 'GET',
                        headers
                    });
                    
                    results.push({
                        endpoint,
                        status: response.status,
                        statusText: response.statusText,
                        success: response.ok
                    });
                } catch (error) {
                    results.push({
                        endpoint,
                        error: error.message,
                        success: false
                    });
                }
            }
            
            resultDiv.innerHTML = `<pre>${JSON.stringify(results, null, 2)}</pre>`;
        }
        
        // 清除认证信息
        function clearAuth() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('user_data');
            localStorage.removeItem('cached_local_ip');
            alert('认证信息已清除');
            location.reload();
        }
        
        // 刷新页面
        function refreshPage() {
            location.reload();
        }
        
        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', function() {
            showAuthStatus();
            showLocalStorageInfo();
            showNetworkInfo();
        });
    </script>
</body>
</html>